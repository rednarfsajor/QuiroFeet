@inherits System.Web.Mvc.WebViewPage
@using System.Web.Mvc
@using System.Web.Optimization
@using System.Web.Routing
@{
    Layout = null;
    ViewBag.Title = "Layout";
}

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <!-- MUY importante para móvil -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />

    <!-- Iconos / Fuente -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />

    @Styles.Render("~/Content/css")
    <link rel="stylesheet" href="~/Content/site.css" />

    <title>@ViewBag.Title - QuiroFeet</title>

    <style>
        :root {
            --qf-bg: #f9fafb;
            --qf-text: #234449;
            --qf-primary: #14532D;
            --qf-accent: #3e77f8;
            --qf-card: #ffffff;
            --qf-border: #e6edf1;
            --sidebar-w: 260px; /* desktop */
            --shadow: 0 10px 30px rgba(0,0,0,.12);
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Poppins', system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
            background-color: var(--qf-bg);
            color: var(--qf-text);
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
        }

        /* ===== Topbar ===== */
        .topbar {
            position: sticky;
            top: 0;
            z-index: 1200;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            background: var(--qf-card);
            border-bottom: 1px solid var(--qf-border);
            padding: 12px 14px;
            box-shadow: 0 2px 10px rgba(0,0,0,.04);
        }

        .topbar-title {
            margin: 0;
            font-size: clamp(1rem, 2.5vw, 1.05rem);
            font-weight: 800;
            letter-spacing: .2px;
            display: flex;
            align-items: center;
            gap: .5rem;
        }

        .sidebar-toggle {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: 1px solid var(--qf-border);
            background: #fff;
            color: var(--qf-primary);
            box-shadow: 0 2px 8px rgba(0,0,0,.06);
            cursor: pointer;
            transition: transform .15s ease, box-shadow .15s ease, background .15s ease;
        }

            .sidebar-toggle:active {
                transform: scale(.98);
            }

            .sidebar-toggle i {
                font-size: 1.2rem;
            }

        /* ===== Sidebar ===== */
        .sidebar {
            position: fixed;
            inset: 0 auto 0 0;
            width: var(--sidebar-w);
            height: 100vh;
            background-color: var(--qf-text);
            color: white;
            padding: 20px 16px;
            overflow-y: auto;
            z-index: 1300;
            transform: translateX(0); /* Desktop visible */
            transition: transform .22s ease;
            will-change: transform;
        }

            .sidebar h1 {
                margin: 0 0 6px 0;
            }

                .sidebar h1 a {
                    color: #93ded7;
                    font-size: 1.05rem;
                    font-weight: 700;
                    text-decoration: none;
                    display: inline-block;
                }

            .sidebar ul {
                list-style: none;
                padding: 0;
                margin: 12px 0 0;
            }

            .sidebar li {
                margin: 8px 0;
            }

            .sidebar a {
                color: white;
                text-decoration: none;
                display: flex;
                align-items: center;
                gap: 12px;
                font-weight: 600;
                line-height: 1.25;
                padding: 10px 10px;
                border-radius: 10px;
                transition: background .15s ease, color .15s ease, transform .12s ease;
            }

                .sidebar a:hover {
                    color: #cfe9ff;
                    background: rgba(255,255,255,.06);
                }

                .sidebar a .bi {
                    font-size: 1.2em;
                }

        /* Overlay móvil */
        .overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,.35);
            z-index: 1250;
            opacity: 0;
            visibility: hidden;
            transition: opacity .22s ease, visibility .22s ease;
        }

            .overlay.is-open {
                opacity: 1;
                visibility: visible;
            }

        /* ===== Contenido ===== */
        .content {
            margin-left: var(--sidebar-w);
            padding: 28px;
            min-height: 100vh;
            background-color: var(--qf-card);
            overflow-wrap: anywhere; /* evita amontonamiento por palabras largas */
        }

            .content .h-scroll {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .content table {
                width: 100%;
                border-collapse: collapse;
            }

        /* ===== Responsive ===== */

        /* Móvil/Tablet */
        @@media (max-width: 1024px) {
            :root {
                --sidebar-w: 70vw;
            }
            /* Sidebar más angosta: 70% */

            .topbar {
                padding: calc(10px + env(safe-area-inset-top)) 14px 12px;
                box-shadow: 0 2px 10px rgba(0,0,0,.08);
            }

            .content {
                margin-left: 0;
                padding: 18px 14px;
                padding-top: calc(16px + 48px); /* espacio bajo la topbar */
                background: #fff;
            }

            .sidebar {
                transform: translateX(-100%); /* off-canvas */
                box-shadow: 4px 0 20px rgba(0,0,0,.25);
                padding: 18px 14px 40px;
                border-top-right-radius: 16px;
            }

                .sidebar.is-open {
                    transform: translateX(0);
                }

                .sidebar h1 a {
                    font-size: 1rem;
                }

                .sidebar ul {
                    margin-top: 10px;
                }

                .sidebar li {
                    margin: 8px 0;
                }

                .sidebar a {
                    gap: 12px;
                    font-size: .95rem;
                    padding: 12px 12px; /* target táctil cómodo */
                    line-height: 1.3;
                }

                    .sidebar a .bi {
                        font-size: 1.1em;
                        min-width: 22px;
                        text-align: center;
                    }

            .overlay {
                background: rgba(0,0,0,.4);
                backdrop-filter: blur(3px);
            }
        }

        /* Móviles pequeños (≤ 400px) */
        @@media (max-width: 400px) {
            :root {
                --sidebar-w: 78vw;
            }
            /* un poquito más ancha en pantallas muy chicas */
            .topbar-title {
                font-size: .98rem;
            }

            .sidebar a {
                font-size: .92rem;
                padding: 11px 11px;
            }

            .content {
                padding: 12px;
                padding-top: calc(12px + 48px);
            }
        }

        /* Desktop (opcional ocultar topbar) */
        @@media (min-width: 1025px) {
            /* .topbar { display: none; } */
        }
    </style>
</head>
<body>

    <!-- Topbar (móvil/tablet) -->
    <div class="topbar" role="banner">
        <button class="sidebar-toggle" id="btnOpenSidebar" aria-label="Abrir menú" aria-controls="appSidebar" aria-expanded="false">
            <i class="bi bi-list"></i>
        </button>
        <h2 class="topbar-title">
            <i class="bi bi-heart-pulse"></i> QuiroFeet
        </h2>
        <span aria-hidden="true" style="width:40px"></span>
    </div>

    <!-- Overlay -->
    <div class="overlay" id="sidebarOverlay"></div>

    <!-- Sidebar -->
    <nav class="sidebar" id="appSidebar" aria-label="Menú lateral">
        <h1><a href="@Url.Action("Index", "Home")">QuiroFeet</a></h1>
        <ul id="sidebarLinks">
            @if (Session["RolNombre"]?.ToString() == "Administrador")
            {
                <li><a href="@Url.Action("ClientIndex", "Clientes")"><i class="bi bi-person"></i> Clientes</a></li>
                <li><a href="@Url.Action("Inventario", "Inventario")"><i class="bi bi-box-seam"></i> Inventario</a></li>
                <li><a href="@Url.Action("Receipts", "Recibos")"><i class="bi bi-receipt"></i> Recibos</a></li>
                <li><a href="@Url.Action("Calendar", "Citas")"><i class="bi bi-calendar2-week"></i> Citas</a></li>
                <li><a href="@Url.Action("Index", "Reportes")"><i class="bi bi-bar-chart-line"></i> Reportes</a></li>
                <li><a href="@Url.Action("ListarOrdenes", "OrdenCompra")"><i class="bi bi-clipboard-data"></i> Órdenes Compra</a></li>
                <li><a href="@Url.Action("ServiceIndex", "Servicios")"><i class="bi bi-gear"></i> Servicios</a></li>
                <li><a href="@Url.Action("Proveedores", "Proveedores")"><i class="bi bi-truck"></i> Proveedores</a></li>
                <li><a href="@Url.Action("Users", "Usuarios")"><i class="bi bi-people"></i> Usuarios</a></li>
                <li><a href="@Url.Action("Sales", "Ventas")"><i class="bi bi-cart-check"></i> Ventas</a></li>
                <li><a href="@Url.Action("Empleados", "Empleados")"><i class="bi bi-briefcase"></i> Empleados</a></li>
            }
            else if (Session["RolNombre"]?.ToString() == "Recepcionista")
            {
                <li><a href="@Url.Action("ClientIndex", "Clientes")"><i class="bi bi-person"></i> Clientes</a></li>
                <li><a href="@Url.Action("Receipts", "Recibos")"><i class="bi bi-receipt"></i> Recibos</a></li>
                <li><a href="@Url.Action("Calendar", "Citas")"><i class="bi bi-calendar2-week"></i> Citas</a></li>
                <li><a href="@Url.Action("Sales", "Ventas")"><i class="bi bi-cart-check"></i> Ventas</a></li>
            }
            else if (Session["RolNombre"]?.ToString() == "Profesional")
            {
                <li><a href="@Url.Action("ClientIndex", "Clientes")"><i class="bi bi-person"></i> Clientes</a></li>
                <li><a href="@Url.Action("Calendar", "Citas")"><i class="bi bi-calendar2-week"></i> Citas</a></li>
            }

            @if (Session["RolNombre"] != null)
            {
                <li>
                    <a href="@Url.Action("Logout", "Account")">
                        <i class="bi bi-box-arrow-right"></i> Cerrar Sesión
                    </a>
                </li>
            }
        </ul>
    </nav>

    <!-- Contenido -->
    <main class="content" role="main">
        @RenderBody()
    </main>

    @Scripts.Render("~/bundles/jquery")
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("Scripts", required: false)

    <script>
        (function () {
            var btn = document.getElementById('btnOpenSidebar');
            var sidebar = document.getElementById('appSidebar');
            var overlay = document.getElementById('sidebarOverlay');
            var links = document.getElementById('sidebarLinks');

            function openSidebar() {
                sidebar.classList.add('is-open');
                overlay.classList.add('is-open');
                btn?.setAttribute('aria-expanded', 'true');
                // bloquea scroll del body en móvil
                document.documentElement.style.overflow = 'hidden';
                document.body.style.overflow = 'hidden';
            }
            function closeSidebar() {
                sidebar.classList.remove('is-open');
                overlay.classList.remove('is-open');
                btn?.setAttribute('aria-expanded', 'false');
                document.documentElement.style.overflow = '';
                document.body.style.overflow = '';
            }

            btn?.addEventListener('click', function () {
                if (sidebar.classList.contains('is-open')) closeSidebar();
                else openSidebar();
            });

            overlay?.addEventListener('click', closeSidebar);

            // Cierra con ESC
            document.addEventListener('keydown', function (e) {
                if (e.key === 'Escape') closeSidebar();
            });

            // Cierra el menú cuando se toca un link en móvil
            links?.addEventListener('click', function (e) {
                var tag = e.target.tagName.toLowerCase();
                if (window.innerWidth <= 1024 && (tag === 'a' || e.target.closest('a'))) {
                    closeSidebar();
                }
            });

            // Si cambias de tamaño a desktop, resetea el lock de scroll
            window.addEventListener('resize', function () {
                if (window.innerWidth > 1024) {
                    closeSidebar();
                }
            });
        })();
    </script>
</body>
</html>
