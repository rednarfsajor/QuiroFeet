@model Analisis.BD.Empleados
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Title = "Confirmar Inactivación";
}

<section class="qf-confirm" style="font-family:'Poppins',sans-serif;">
    <header class="qf-header">
        <h1>Inactivar Empleado</h1>
        <p class="qf-subtitle">Confirma que deseas inactivar este usuario.</p>
    </header>

    <div class="confirm-card" role="region" aria-labelledby="confirm-title">
        <div class="confirm-icon warn" aria-hidden="true">
            <i class="bi bi-exclamation-triangle-fill"></i>
        </div>

        <h2 id="confirm-title" class="confirm-title">¿Está seguro que desea inactivar este usuario?</h2>
        <p class="confirm-text">
            Esta acción <strong>no eliminará</strong> sus datos históricos (citas y registros se conservan).
        </p>

        <div class="emp-info">
            <div class="emp-row"><span class="lbl">ID:</span> <span>@Model.id</span></div>
            <div class="emp-row"><span class="lbl">Nombre:</span> <span>@Model.nombre</span></div>
            <div class="emp-row"><span class="lbl">Tipo:</span> <span>@Model.tipo</span></div>
            <div class="emp-row"><span class="lbl">Correo:</span> <span>@Model.correo</span></div>
            <div class="emp-row"><span class="lbl">Teléfono:</span> <span>@Model.telefono</span></div>
        </div>

        @* Enviamos por fetch para mostrar el toast de éxito *@
        @using (Html.BeginForm("DeleteEmpleados", "Empleados", FormMethod.Post, new { @class = "confirm-actions", id = "frmInactivar" }))
        {
            @Html.AntiForgeryToken()
            @Html.HiddenFor(m => m.id)

            <button type="submit" class="btn-pill btn-warning" aria-label="Confirmar inactivación" id="btnInactivar">
                <i class="bi bi-person-slash" aria-hidden="true"></i> Inactivar usuario
            </button>

            <a href="@Url.Action("DetallesEmpleados","Empleados")" class="btn-pill btn-secondary" aria-label="Cancelar y regresar">
                <i class="bi bi-arrow-left" aria-hidden="true"></i> Cancelar
            </a>
        }
    </div>
</section>

@* --- Toasts (éxito / error) --- *@
<div id="toastSuccess" class="toast-message">
    <i class="bi bi-check-circle-fill"></i>
    <span>Usuario inactivado correctamente.</span>
</div>
<div id="toastError" class="toast-message toast-error">
    <i class="bi bi-x-circle-fill"></i>
    <span>Ocurrió un error al inactivar. Inténtalo nuevamente.</span>
</div>

<script>
    (function () {
        const form = document.getElementById('frmInactivar');
        const btn = document.getElementById('btnInactivar');
        const toastOk = document.getElementById('toastSuccess');
        const toastErr = document.getElementById('toastError');

        function showToast(el) {
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3500);
        }

        if (form) {
            form.addEventListener('submit', async function (e) {
                e.preventDefault();
                btn.disabled = true;

                try {
                    const fd = new FormData(form); // incluye __RequestVerificationToken e id
                    const resp = await fetch(form.action, {
                        method: 'POST',
                        body: fd,
                        credentials: 'same-origin'
                    });

                    if (resp.ok) {
                        showToast(toastOk);
                        // redirige al listado (solo activos) tras el toast
                        setTimeout(() => {
                            window.location.href = '@Url.Action("DetallesEmpleados","Empleados", new { incluirInactivos = false })';
                        }, 900);
                    } else {
                        showToast(toastErr);
                        btn.disabled = false;
                    }
                } catch (err) {
                    showToast(toastErr);
                    btn.disabled = false;
                    console.error(err);
                }
            });
        }
    })();
</script>

<style>
    :root {
        --qf-brand: #213435;
        --qf-accent: #0FC57C;
        --qf-ink: #223032;
        --qf-ink-muted: #5a6a6d;
        --qf-border: rgba(33,52,53,.14);
        --qf-surface: #ffffff;
        --qf-shadow: 0 12px 28px rgba(0,0,0,.10);
        --qf-radius: 18px;
        --warn-bg: #fff4e5;
        --warn-fg: #b76e00;
    }

    .qf-confirm {
        max-width: 820px;
        margin: clamp(28px,5vh,64px) auto;
        padding: 10px 14px 40px;
        color: var(--qf-ink);
        background: radial-gradient(900px 520px at 12% -20%, rgba(15,197,124,.08), transparent 60%), radial-gradient(900px 520px at 110% 110%, rgba(33,52,53,.06), transparent 55%);
        border-radius: 20px;
    }

    .qf-header {
        text-align: center;
        margin: 0 auto 18px;
        padding: 18px 16px;
        max-width: 720px;
        background: linear-gradient(180deg, rgba(33,52,53,.06), rgba(33,52,53,0));
        border: 1px solid var(--qf-border);
        border-radius: 18px;
    }

        .qf-header h1 {
            margin: 0 0 6px 0;
            color: var(--qf-brand);
            font-weight: 800;
            letter-spacing: .3px;
            font-size: clamp(1.6rem,1.2rem + 1.4vw,2.1rem);
        }

    .qf-subtitle {
        margin: 0;
        color: var(--qf-ink-muted);
        font-size: clamp(.98rem,.95rem + .2vw,1.05rem);
    }

    .confirm-card {
        margin: 20px auto 0;
        background: var(--qf-surface);
        border: 1px solid var(--qf-border);
        border-radius: var(--qf-radius);
        box-shadow: var(--qf-shadow);
        padding: clamp(18px, 2.2vw, 28px);
        text-align: center;
    }

    .confirm-icon {
        width: 64px;
        height: 64px;
        margin: 6px auto 10px;
        border-radius: 50%;
        display: grid;
        place-items: center;
    }

        .confirm-icon.warn {
            background: var(--warn-bg);
            color: var(--warn-fg);
            box-shadow: inset 0 6px 14px rgba(183,110,0,.15);
        }

        .confirm-icon i {
            font-size: 28px;
        }

    .confirm-title {
        margin: 8px 0 4px 0;
        font-weight: 800;
        color: var(--qf-brand);
        font-size: clamp(1.2rem, 1rem + .6vw, 1.5rem);
        letter-spacing: .2px;
    }

    .confirm-text {
        margin: 0 0 14px 0;
        color: var(--qf-ink-muted);
    }

    .emp-info {
        display: grid;
        grid-template-columns: 1fr;
        gap: 8px;
        text-align: left;
        max-width: 560px;
        margin: 0 auto 18px;
        background: #fbfdfc;
        border: 1px solid #eef2f1;
        border-radius: 14px;
        padding: 12px 14px;
    }

    .emp-row {
        display: flex;
        gap: 8px;
    }

        .emp-row .lbl {
            width: 110px;
            color: var(--qf-ink-muted);
            font-weight: 700;
        }

    .confirm-actions {
        display: flex;
        justify-content: center;
        gap: 12px;
        flex-wrap: wrap;
        margin-top: 8px;
    }

    .btn-pill {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 10px 16px;
        border-radius: 999px;
        font-size: .95rem;
        font-weight: 800;
        text-decoration: none;
        border: 1px solid transparent;
        transition: transform .18s ease, box-shadow .18s ease, background-color .18s ease, border-color .18s ease;
        cursor: pointer;
    }

    .btn-warning {
        color: #4b3a13;
        background: #f6c76c;
        border-color: #e7b85d;
    }

        .btn-warning:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 18px rgba(246,199,108,.26);
            background: #ecb74b;
        }

    .btn-secondary {
        color: #fff;
        background: #213435;
        border-color: #1b2b2c;
    }

        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 18px rgba(33,52,53,.20);
            background: #1a2b2c;
        }

    .btn-pill:focus-visible {
        outline: none;
        box-shadow: 0 0 0 4px rgba(15,197,124,.35);
    }

    /* Toasts */
    .toast-message {
        position: fixed;
        top: 26px;
        right: 26px;
        display: flex;
        align-items: center;
        gap: 10px;
        background: #0fc57c;
        color: #fff;
        padding: 12px 16px;
        border-radius: 12px;
        box-shadow: 0 10px 24px rgba(0,0,0,.18);
        z-index: 9999;
        opacity: 0;
        transform: translateY(-20px);
        transition: all .35s ease;
        pointer-events: none;
    }

        .toast-message.show {
            opacity: 1;
            transform: translateY(0);
        }

        .toast-message i {
            font-size: 1.2rem;
        }

    .toast-error {
        background: #e04b4b;
    }

    /* Responsive (en Razor usa @@media) */
    @@media (max-width: 640px) {
        .emp-row .lbl {
            width: 96px;
        }

        .confirm-actions {
            gap: 10px;
        }

        .btn-pill {
            padding: 9px 14px;
            font-size: .92rem;
        }
    }
</style>
